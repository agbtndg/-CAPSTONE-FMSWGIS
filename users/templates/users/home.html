{% extends 'users/base.html' %}

{% block title %}DRRMO Dashboard{% endblock %}

{% block header_title %}Dashboard{% endblock %}

{% block styles %}
<style>
    .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }

    /* Clean card design with minimal styling and professional appearance */
    .dashboard-card {
        background: white;
        padding: 24px;
        border-radius: 8px;
        border: 1px solid var(--border-gray);
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        transition: all 0.2s ease;
    }

    .dashboard-card:hover {
        border-color: var(--secondary-blue);
        box-shadow: 0 4px 12px rgba(37, 99, 235, 0.1);
    }

    .dashboard-card h3 {
        margin-top: 0;
        margin-bottom: 12px;
        color: var(--text-dark);
        font-size: 18px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .dashboard-card h3 i {
        color: var(--secondary-blue);
        font-size: 20px;
    }

    .dashboard-card p {
        color: var(--text-muted);
        margin-bottom: 16px;
        font-size: 14px;
        line-height: 1.5;
    }

    .card-link {
        display: inline-block;
        background-color: var(--secondary-blue);
        color: white;
        padding: 10px 20px;
        text-decoration: none;
        border-radius: 6px;
        transition: all 0.2s;
        font-size: 14px;
        font-weight: 500;
    }

    .card-link:hover {
        background-color: var(--primary-blue);
        color: white;
        text-decoration: none;
        transform: translateY(-1px);
    }

    .status-badge {
        padding: 4px 10px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 600;
        color: white;
        display: inline-block;
    }

    .status-low { background-color: #10b981; }
    .status-moderate { background-color: #f59e0b; }
    .status-high { background-color: #ef6b3f; }
    .status-critical { background-color: #ef4444; }

    .quick-stats {
        display: flex;
        gap: 12px;
        margin-bottom: 16px;
        flex-wrap: wrap;
    }

    .stat-item {
        background: var(--light-gray);
        padding: 10px 14px;
        border-radius: 6px;
        font-size: 13px;
        border: 1px solid var(--border-gray);
    }

    .stat-value {
        font-weight: 600;
        color: var(--text-dark);
    }

    .recent-list {
        list-style: none;
        padding: 0;
        margin: 12px 0;
    }

    .recent-list li {
        padding: 8px 0;
        border-bottom: 1px solid var(--border-gray);
        font-size: 13px;
        color: var(--text-muted);
    }

    .recent-list li:last-child {
        border-bottom: none;
    }

    .admin-section {
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid var(--border-gray);
    }

    .admin-section h2 {
        font-size: 18px;
        font-weight: 600;
        color: var(--text-dark);
        margin-bottom: 16px;
    }

    /* New activity card styling */
    .activity-highlight {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }

    .activity-highlight h3 {
        color: white;
    }

    .activity-highlight h3 i {
        color: rgba(255, 255, 255, 0.9);
    }

    .activity-highlight p {
        color: rgba(255, 255, 255, 0.9);
    }

    .activity-highlight .card-link {
        background: rgba(255, 255, 255, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .activity-highlight .card-link:hover {
        background: rgba(255, 255, 255, 0.3);
        border-color: rgba(255, 255, 255, 0.5);
    }

    @media (max-width: 768px) {
        .dashboard-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
    {% if combined_risk %}
    <div class="quick-stats">
        <div class="stat-item">
            <strong>Overall Risk:</strong>
            <span class="status-badge" style="background-color: {{ combined_risk.color }}">
                {{ combined_risk.level }}
            </span>
        </div>
        {% if weather_data %}
        <div class="stat-item">
            <strong>Temperature:</strong> <span class="stat-value">{{ weather_data.temperature_c }}Â°C</span>
        </div>
        <div class="stat-item">
            <strong>Humidity:</strong> <span class="stat-value">{{ weather_data.humidity_percent }}%</span>
        </div>
        <div class="stat-item">
            <strong>Wind:</strong> <span class="stat-value">{{ weather_data.wind_speed_kph }} km/h</span>
        </div>
        {% endif %}
    </div>
    {% endif %}

    <div class="dashboard-grid">
        <div class="dashboard-card">
            <h3><i class="fas fa-map"></i> Maps</h3>
            <p>Access geographical data, flood maps, and barangay information for Silay City.</p>
            <a href="{% url 'map_view' %}" class="card-link"><i class="fas fa-arrow-right"></i> View Maps</a>
        </div>

        <div class="dashboard-card">
            <h3><i class="fas fa-chart-line"></i> Monitoring</h3>
            <p>Track real-time weather conditions, rainfall data, and flood monitoring information.</p>
            {% if recent_floods %}
            <div class="recent-list">
                <strong style="color: var(--text-dark);">Recent Flood Events:</strong>
                {% for flood in recent_floods %}
                <li>{{ flood.event }} ({{ flood.date|date:"M d, Y" }})</li>
                {% endfor %}
            </div>
            {% endif %}
            <a href="{% url 'monitoring_view' %}" class="card-link"><i class="fas fa-arrow-right"></i> View Monitoring</a>
        </div>

        <!-- New Activity History Card -->
        <div class="dashboard-card activity-highlight">
            <h3><i class="fas fa-history"></i> My Activity History</h3>
            <p>View all your assessments, reports, and certificates that you've generated.</p>
            <a href="{% url 'my_activity' %}" class="card-link"><i class="fas fa-arrow-right"></i> View My Activities</a>
        </div>

        {% if user.is_staff %}
        <div class="dashboard-card">
            <h3><i class="fas fa-users"></i> User Management</h3>
            <div class="quick-stats">
                <div class="stat-item">
                    Pending: <span class="stat-value">{{ pending_approvals }}</span>
                </div>
                <div class="stat-item">
                    Active: <span class="stat-value">{{ total_users }}</span>
                </div>
            </div>
            {% if recent_logs %}
            <div class="recent-list">
                <strong style="color: var(--text-dark);">Recent Activity:</strong>
                {% for log in recent_logs %}
                <li>{{ log.user.username }} - {{ log.action }} ({{ log.timestamp|timesince }} ago)</li>
                {% endfor %}
            </div>
            {% endif %}
            <a href="{% url 'approve_users' %}" class="card-link"><i class="fas fa-arrow-right"></i> Manage Users</a>
        </div>

        <!-- New Admin All Activities Card -->
        <div class="dashboard-card">
            <h3><i class="fas fa-clipboard-list"></i> All Staff Activities</h3>
            <p>Monitor and review all assessments, reports, and certificates from all staff members.</p>
            <a href="{% url 'all_activities' %}" class="card-link"><i class="fas fa-arrow-right"></i> View All Activities</a>
        </div>
        {% endif %}
    </div>
{% endblock %}